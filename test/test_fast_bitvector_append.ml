open! Expect_test_helpers_core
open! Sexplib0.Sexp_conv

let%expect_test "Append" =
  let b = Fast_bitvector.create_full ~len:100 in
  for i = 1 to 65 do
    let a = Fast_bitvector.create ~len:i in
    let ab = Fast_bitvector.append a b in
    print_s [%message "" ~popcount:(Fast_bitvector.popcount ab : int) (ab : Fast_bitvector.t)];
  done;
  [%expect {|
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000)))
    ((popcount 100)
     (ab (
       B0L
       111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000)))
    |}]

let%expect_test "Append" =
  let b = Fast_bitvector.create ~len:100 in
  for i = 1 to 65 do
    let a = Fast_bitvector.create_full ~len:i in
    let ab = Fast_bitvector.append a b in
    print_s [%message "" ~popcount:(Fast_bitvector.popcount ab : int) (ab : Fast_bitvector.t)];
  done;
  [%expect {|
    ((popcount 1)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001)))
    ((popcount 2)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011)))
    ((popcount 3)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111)))
    ((popcount 4)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111)))
    ((popcount 5)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111)))
    ((popcount 6)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111)))
    ((popcount 7)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111)))
    ((popcount 8)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111)))
    ((popcount 9)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111)))
    ((popcount 10)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111)))
    ((popcount 11)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111)))
    ((popcount 12)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111)))
    ((popcount 13)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111)))
    ((popcount 14)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111)))
    ((popcount 15)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111)))
    ((popcount 16)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111)))
    ((popcount 17)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111)))
    ((popcount 18)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111)))
    ((popcount 19)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111)))
    ((popcount 20)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111)))
    ((popcount 21)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111)))
    ((popcount 22)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111)))
    ((popcount 23)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111)))
    ((popcount 24)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111)))
    ((popcount 25)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111)))
    ((popcount 26)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111)))
    ((popcount 27)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111)))
    ((popcount 28)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111)))
    ((popcount 29)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111)))
    ((popcount 30)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111)))
    ((popcount 31)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111)))
    ((popcount 32)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111)))
    ((popcount 33)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111)))
    ((popcount 34)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111)))
    ((popcount 35)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111)))
    ((popcount 36)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111)))
    ((popcount 37)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111)))
    ((popcount 38)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111)))
    ((popcount 39)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111)))
    ((popcount 40)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111)))
    ((popcount 41)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111)))
    ((popcount 42)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111)))
    ((popcount 43)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111)))
    ((popcount 44)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111)))
    ((popcount 45)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111)))
    ((popcount 46)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111)))
    ((popcount 47)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111)))
    ((popcount 48)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111)))
    ((popcount 49)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111)))
    ((popcount 50)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111)))
    ((popcount 51)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111)))
    ((popcount 52)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111)))
    ((popcount 53)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111)))
    ((popcount 54)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111)))
    ((popcount 55)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111)))
    ((popcount 56)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111)))
    ((popcount 57)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111)))
    ((popcount 58)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111)))
    ((popcount 59)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111)))
    ((popcount 60)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111)))
    ((popcount 61)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111)))
    ((popcount 62)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111)))
    ((popcount 63)
     (ab (
       B0L
       0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111)))
    ((popcount 64)
     (ab (
       B0L
       00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111)))
    ((popcount 65)
     (ab (
       B0L
       000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111)))
    |}]
